CREATE DATABASE QLPCNSDA2;
GO

USE QLPCNSDA2;
GO

CREATE TABLE PHONG_BAN (
	MaPHG INT PRIMARY KEY,
	TenPHG NVARCHAR(30) NOT NULL,
	TRPHG INT,
	Ng_NhamChuc DATE
);

CREATE TABLE NHAN_VIEN (
	MaNV INT PRIMARY KEY,
	HoNV NVARCHAR(30) NOT NULL,
	TenNV NVARCHAR (10) NOT NULL,
	NgaySinh DATE,
	Phai NVARCHAR(3),
	Luong INT,
	PHG INT, 
	CONSTRAINT FK_NV_PHG FOREIGN KEY (PHG) REFERENCES PHONG_BAN(MaPHG)
	);

ALTER TABLE PHONG_BAN
	ADD CONSTRAINT FK_PB_TRPHG FOREIGN KEY (TRPHG) REFERENCES NHAN_VIEN(MaNV);

CREATE TABLE DE_AN (
	MaDA INT PRIMARY KEY,
	TenDA NVARCHAR(50) NOT NULL, 
	PHG INT
	CONSTRAINT FK_DA_PHG FOREIGN KEY (PHG) REFERENCES PHONG_BAN(MaPHG));

CREATE TABLE PHAN_CONG (
	MaNV INT,
	MaDA INT,
	ThoiGian INT NOT NULL,
	CONSTRAINT FK_PC_NV FOREIGN KEY (MaNV) REFERENCES NHAN_VIEN(MaNV),
	CONSTRAINT FK_PC_DA FOREIGN KEY (MaDA) REFERENCES DE_AN(MaDA),
	PRIMARY KEY (MaNV, MaDA)
	);

INSERT INTO PHONG_BAN VALUES (1, N'Kế toán', NULL, NULL);
INSERT INTO PHONG_BAN VALUES (2, N'Hành chính', NULL, NULL);
INSERT INTO PHONG_BAN VALUES (3, N'Kế hoạch tổng hợp', NULL, NULL);
INSERT INTO PHONG_BAN VALUES (4, N'Dự án 1', NULL, NULL);
INSERT INTO PHONG_BAN VALUES (5, N'Dự án 2', NULL, NULL);

INSERT INTO NHAN_VIEN VALUES (1, N'Phạm Hà', N'An', '1980-09-26', N'Nam', 22000000, 4);
INSERT INTO NHAN_VIEN VALUES (2, N'Chu Văn', N'Hưng', '1990-08-25', N'Nam', 23000000, 5);
INSERT INTO NHAN_VIEN VALUES (3, N'Nguyễn Hoàng', N'Anh', '1993-07-24', N'Nam', 24000000, 3);
INSERT INTO NHAN_VIEN VALUES (4, N'Bùi Văn', N'Đĩnh', '1989-06-23', N'Nam', 25000000, 2);
INSERT INTO NHAN_VIEN VALUES (5, N'Đỗ Thị Tuyết', N'Mai', '1985-05-11', N'Nữ', 22000000, 1);

UPDATE PHONG_BAN SET TRPHG = 1 WHERE MaPHG = 1;
UPDATE PHONG_BAN SET TRPHG = 2 WHERE MaPHG = 2;
UPDATE PHONG_BAN SET TRPHG = 3 WHERE MaPHG = 3;
UPDATE PHONG_BAN SET TRPHG = 4 WHERE MaPHG = 4;
UPDATE PHONG_BAN SET TRPHG = 5 WHERE MaPHG = 5;

INSERT INTO DE_AN VALUES (1, N'Xây cầu', 1);
INSERT INTO DE_AN VALUES (2, N'Xây nhà', 2);
INSERT INTO DE_AN VALUES (3, N'Xây cầu', 3);
INSERT INTO DE_AN VALUES (4, N'Xây cầu', 4);
INSERT INTO DE_AN VALUES (5, N'Xây cầu', 5);
INSERT INTO DE_AN VALUES (6, N'Xây cầu', 1);

INSERT INTO PHAN_CONG VALUES (1, 1, 100);
INSERT INTO PHAN_CONG VALUES (1, 2, 80);
INSERT INTO PHAN_CONG VALUES (2, 3, 100);
INSERT INTO PHAN_CONG VALUES (2, 4, 90);
INSERT INTO PHAN_CONG VALUES (2, 5, 70);
INSERT INTO PHAN_CONG VALUES (3, 3, 100);
INSERT INTO PHAN_CONG VALUES (4, 4, 100);
INSERT INTO PHAN_CONG VALUES (5, 5, 100);
